---
description: "分形自指文档规范"
alwaysApply: true
---

## 分形自指文档规范

### 核心目标

- 保证“就近可发现、分层可收敛、改动可追溯”
- 文档更新范围应**最小必要**，避免无意义的层级扩散

### 变更范围判断（工作结束前必须收尾）

- **总原则**：更新与你本次改动**直接相关**且**必要可发现**的文档层级，不做全量覆盖。
- **必须更新**：
  - 变更文件的“文件头注释”（3 行：`input` / `output` / `pos`）
  - 变更所在目录的 `README.md`（3 行以内的目录说明 + 文件清单）
- **按需更新**（由改动影响范围决定）：
  - 上一级或下一级目录 `README.md`（仅当目录职责/边界/入口发生变化）
  - 文档索引入口（`docs/README.md` 或根 `README.md`，仅当出现新入口、入口消失或入口职责变更）

### 目录 README 规范（每个源码目录都要有）

- 每个源码目录必须有 `README.md`，开头 **3 行以内**说明：
  - 这个目录是什么（边界/职责）
  - 与哪些上/下游交互（输入/输出的方向，不写细节）
  - **更新规则**：目录内文件变化时必须更新本 README；必要时再更新上层索引
- README 下方必须列出该目录下每个文件（以及子目录入口 README）的**地位与功能**（一句话即可）。

### 文件头注释规范（每个源码文件都要有）

- 每个 `.js/.jsx/.ts/.tsx/.py` 文件开头必须包含 3 行极简注释：
  - `input:` 依赖外部的什么（外部模块/环境/IO/DB/API）
  - `output:` 对外提供什么（导出/副作用/对外可见行为）
  - `pos:` 在局部系统中的位置（谁调用它/它服务谁；并注明“变更需同步更新本头注释与所属目录 README”）

### 禁止

- 不允许用 TODO/FIXME/“之后补文档”来跳过上述收尾；不允许引入兼容层来规避全链路更新。

