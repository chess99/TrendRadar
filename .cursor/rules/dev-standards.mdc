---
description: "开发规范提醒：以高质量为目标（但保留权衡空间）"
alwaysApply: true
---

## 开发规范提醒（给 AI 的高标准自检）

目标不仅仅是“代码能运行”，而是**正确、易读、可维护、可演进**。以下原则并非僵化的教条，请基于上下文进行权衡。若你的代码决策属于“非直觉”或“有争议”的做法，**必须**在注释中简述原因（无需长篇大论）。

### 核心原则（决策依据）

- **融合优于创新**：优先沿用现有的架构、命名、目录结构和交互模式；除非收益明确且巨大，否则不要引入“新范式”或异类写法。
- **DRY 的 ROI 权衡**：
  - **何时抽象**：当你**同时修改多个重复点**，或预计该逻辑短期内会频繁变动且容易遗漏同步时，请优先进行**小而窄**的抽象。
  - **何时容忍重复**：如果改动风险高或仅涉及单点逻辑，允许局部重复。将改动控制在“当前模块作用域”内，必要时简注“为何暂不抽象”。
- **触发式抽象（提升默认质量）**：
  - 当你引入的逻辑在仓库中已存在**相似实现**（即出现第 2 处重复），且抽象成本低、侵入性小、可回滚时，请默认抽取为组件或 Hook。
  - 若决定不抽取（如历史代码耦合度高、改动范围不可控），必须保留一句注释说明理由，防止后续被误判为“无意的重复代码”。
- **拒绝过度设计**：只为已知需求或极近期的演进预留接口；严禁为了“可能会用”而提前增加复杂度（YAGNI 原则）。
- **最小化改动**：能通过小改动解决的问题，不要进行大重构；若必须大改，请分层、分步进行，并注明原因与边界。
- **可重构性优先**：代码应保持“行为可预测 + 改动可局部验证”；宁可多写几行清晰的显式代码，也不要堆叠晦涩的隐式技巧。

### 质量自检清单（编码后必读）

- **正确性与健壮性**：边界条件、空值（Null/Undefined）、异常路径、并发/竞态（如异步 setState / 依赖项过时）是否已处理？杜绝“偶发性故障”。
- **类型契约**：入参/出参/状态的类型定义清晰；可选字段优先用 `undefined` 表示“未提供”；严格限制 `any` 的使用。
- **可读性**：命名应准确体现意图；控制流保持扁平；减少不必要的跨文件跳转；复杂逻辑拆解为纯函数，注释重点解释“为什么这样做/有什么约束”，而非“正在做什么”。
- **副作用隔离**：尽量将 I/O、网络请求、存储等副作用收敛到边界层；核心业务逻辑保持纯函数化，便于复用与测试。
- **错误处理**：向用户展示可操作的错误提示；**禁止静默吞错**（除非有明确理由并备注）；日志需包含关键上下文，但避免泛滥。
- **一致性**：UI/交互细节（Loading 态、禁用态、数据回显、分页逻辑）需与项目内相似场景保持高度一致。
- **性能与体验**：避免无意义的请求或重渲染；列表/搜索输入使用 Debounce；必要时实现预加载以提升回显速度。
- **安全与合规**：严禁提交敏感信息（AK/SK）；禁止在日志中打印 Token 或用户隐私数据；对外部输入进行必要的校验与转义。
- **文档索引**：严格遵守本仓库的 `fractal-docs.mdc` 规范（如文件头注释、目录 README 更新）。

### 备注

- 本文档旨在**提醒**而非**束缚**；当你判断“偏离规范”是当前场景下的更优解（如为了紧急交付而暂缓重构），允许偏离，但请务必留下简短说明，以便后续维护者理解上下文。